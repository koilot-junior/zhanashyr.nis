<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–®–∞–≥ –∫ —Å–ª–æ–≤—É</title>
  <style>
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background: #a8c5a1; /* –§–∏—Å—Ç–∞—à–∫–æ–≤—ã–π —Ñ–æ–Ω */
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      position: relative;
      padding: 2rem;
    }

    h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: #2f3e2f;
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 2rem;
      color: #3f5140;
    }

    .video-container {
  width: 100%;
  max-width: 800px;
  margin: 1.5rem auto;
  text-align: center;
}

.video-container iframe {
  display: block;
  margin: 0 auto;
  width: 100%;
  height: 450px;
  border-radius: 12px;
  border: none;
}

    .image-gallery {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 2rem 0;
      flex-wrap: wrap;
    }

    .image-gallery img {
      width: 200px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      background-color: #fefbf6;
      padding: 6px;
    }

    .block_n1 {
      width: 200vmin;
      height: 75vmin;
      background-color: white;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      display: flex;
      position: relative;
      overflow: hidden;
    }
    .block_n2 {
      width: 200vmin;
      height: 340vmin;
      background-color: white;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      display: flex;
      position: relative;
      overflow: hidden;
    }
    .block_n3 {
      width: 200vmin;
      height: 340vmin;
      background-color: white;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      display: flex;
      position: relative;
      overflow: hidden;
    }

    .block_n1::before {
      content: '';
      position: absolute;
      top: 5%; /* –û—Å—Ç–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
      bottom: 5%; /* –ò —Å–Ω–∏–∑—É */
      left: 30%; /* –¢–æ—á–∫–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è */
      width: 5px;
      background-color: #F5F5DC;
      z-index: 1;
    }
    .block_n2::before {
      content: '';
      position: absolute;
      top: 5%; /* –û—Å—Ç–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
      bottom: 5%; /* –ò —Å–Ω–∏–∑—É */
      left: 30%; /* –¢–æ—á–∫–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è */
      width: 5px;
      background-color: #F5F5DC;
      z-index: 1;
    }
    .block_n3::before {
      content: '';
      position: absolute;
      top: 5%; /* –û—Å—Ç–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
      bottom: 5%; /* –ò —Å–Ω–∏–∑—É */
      left: 30%; /* –¢–æ—á–∫–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è */
      width: 5px;
      background-color: #F5F5DC;
      z-index: 1;
    }

    .left,
    .right {
      padding: 20px;
      z-index: 2; /* –ß—Ç–æ–±—ã –±—ã—Ç—å –ø–æ–≤–µ—Ä—Ö –ø—Å–µ–≤–¥–æ—ç–ª–µ–º–µ–Ω—Ç–∞ */
    }

    .left {
      width: 15%;
      background-color: #d7d7d7;
      text-align: center;
    }

    .right {
      width: 85%;
      background-color: #F5F5DC;
    }
    .button-group button {
  background-color: #a8c5a1; /* –§–∏—Å—Ç–∞—à–∫–∞–≤–∞—è –∫–Ω–æ–ø–∫–∞ */
  color: #333;
  padding: 0.8rem 1.5rem;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
  box-shadow: 0 3px 6px rgba(0,0,0,0.1);
}

.button-group button:hover {
  background-color: #5e7768;  /* –ù–µ–º–Ω–æ–≥–æ —Ç–µ–º–Ω–µ–µ */
  transform: scale(1.05);     /* –õ—ë–≥–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ */
}

.button-group button:active {
  transform: scale(0.97);
}


    .button-group button:hover {
      background-color: #89ac97;
    }

    header{
        background-color: #2f3e2f;
        padding: 100px;
        text-align: center;
    }
     .wrapperSimple {
  background-color: #f8f8c7;
  border-radius: 20px;
  padding: 2.5rem;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
  max-width: 1000px;
  width: 100%;
  margin: 2rem auto;
}

     .padding {
        padding: 15px;
     }

     .game-container {
  display: grid;
  grid-template-columns: repeat(4, 100px);
  gap: 12px;
  perspective: 1200px;
}

.card {
  width: 100px;
  height: 140px;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.5s ease;
}

.card:hover {
  transform: scale(1.03);
}

.card.flipped {
  transform: rotateY(180deg);
}

.card-face {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  background-color: white;
  transition: all 0.3s ease;
  padding: 8px;
  text-align: center;
  box-sizing: border-box;
}

.card-front {
  background-color: #ffffff;
}

.card-back {
  background-color: #a8c5a1;
  color: white;
  transform: rotateY(180deg);
}

video {
      border: 1px solid #ccc;
      width: 640px;
      height: 480px;
    }

        canvas {
      position: absolute;
      top: 0;
      left: 0;
    }

     #container {
      position: relative;
      display: inline-block;
    }

    #note, #targetEmotionText, #resultText, #timerText {
      margin-top: 15px;
      font-size: 20px;
    }

    #randomEmotionBtn {
      background-color: #d32f2f; /* –∫—Ä–∞—Å–Ω—ã–π */
      color: white;
      border: none;
      border-radius: 5px;
      transition: background-color 0.3s;
  padding: 0.8rem 1.5rem;
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
  box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    #randomEmotionBtn:hover:not(:disabled) {
      background-color: #9a2424;
    }
    #randomEmotionBtn:disabled {
      background-color: #f4a2a2;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="block_n1">
    <div class="left">
      <div class="button-group">
        <button class="button" onclick="readTextOnBlockN1()"><h1>üîä</h1></button>
      </div>
    </div>
    <div class="right">
      <div id="targetTextOnBlockN1">
        <h1><header class="wrapperSimple" data-translate="privet">–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</header></h1>
        <h1 data-translate="salam">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π –¥—Ä—É–≥!</h1>
        <h2 data-translate="yasyk">–¢—ã –º–æ–∂–µ—à—å –≤—ã–±—Ä–∞—Ç—å —è–∑—ã–∫</h2>
        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ -->
        <div class="language-switcher">
          <div class="button-group">
            <button class="button" onclick="setLanguage('ru')">–†—É—Å—Å–∫–∏–π</button>
            <button class="button" onclick="setLanguage('kz')">–ö–∞–∑–∞—Ö—Å–∫–∏–π</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="padding"></div>
  <div class="block_n2">
    <div class="left">
      <div class="button-group">
        <button class="button" onclick="readTextOnBlockN2()"><h1>üîä</h1></button>
      </div>
    </div>
    <div class="right">
      <div id="targetTextOnBlockN2">
        <h1><header class="wrapperSimple">–ò—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä—ã</header></h1>
        <h2>–¢–µ–±–µ –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–∞—Ä–∏—Ç—å –∑–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º</h2>
        <!-- –û–∂–∏–¥–∞–µ–º–∞—è —Ñ—Ä–∞–∑–∞ -->
        <h2 data-translate="expected_phrase">–û–∂–∏–¥–∞–µ–º–∞—è —Ñ—Ä–∞–∑–∞:</h2>
        <h1><p id="target">...</p></h1>
        
        <!-- –†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–∞—è —Ñ—Ä–∞–∑–∞ -->
        <h2 data-translate="recognized_phrase">–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–∞—è —Ñ—Ä–∞–∑–∞:</h2>
        <h1><p id="output">...</p></h1>
        
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
        <h2 data-translate="result_label">–†–µ–∑—É–ª—å—Ç–∞—Ç:</h2>
        <h1><p id="result">–û–∂–∏–¥–∞–µ—Ç—Å—è –≤–≤–æ–¥...</p></h1>
        
        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <div class="button-group">
          <button class="button" id="start" data-translate="speak_btn"><h2>üé§ –ì–æ–≤–æ—Ä–∏—Ç—å</h2></button>
          <button class="button" onclick="speakText()" data-translate="tts_btn">üîä –û–∑–≤—É—á–∏—Ç—å</button>
          <button class="button" onclick="generateWords()" data-translate="refresh_btn">–û–±–Ω–æ–≤–∏—Ç—å —Å–ª–æ–≤–∞</button>
        </div>
      <div class="padding"></div>
      <div class="game-container" id="game"></div>
      <div class="padding"></div>
      <button id="startBtn" class="button-group"><div class="button"><h1>–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É</h1></div></button>
      <button id="randomEmotionBtn" disabled>–ü–æ–∫–∞–∑–∞—Ç—å —Å–ª—É—á–∞–π–Ω—É—é —ç–º–æ—Ü–∏—é</button>
      
      <h1>–ò–≥—Ä–∞: –¥–µ—Ä–∂–∏ —ç–º–æ—Ü–∏—é 2 —Å–µ–∫—É–Ω–¥—ã üòäüò†üòÆüòê (—Å –æ–∑–≤—É—á–∫–æ–π)</h1>
      <div id="container">
      <video id="video" autoplay muted playsinline width="640" height="480"></video>
      <canvas id="overlay" width="640" height="480"></canvas>
      </div>
      
      <div id="targetEmotionText">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —ç–º–æ—Ü–∏—é</div>
      <div id="timerText"></div>
      <div id="resultText"></div>
      <div id="note">–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞...</div>
    </div>
    </div>
  </div>
  <div class="padding"></div>
  <div class="block_n3">
    <div class="left">
      <div class="button-group">
        <button class="button" onclick="readTextOnBlockN3()"><h1>üîä</h1></button>
      </div>
    </div>
    <div class="right">
      <div id="targetTextOnBlockN3">
        <h1><header class="wrapperSimple">–ü–∞–º—è—Ç–∫–∞ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π</header></h1>
        <p>text for pamatke dlya roditeley</p>
      </div>
    </div>
  </div>
  <div class="padding"></div>
  <footer>
    &copy; 2025 –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
  <script>
    // –ü–µ—Ä–µ–≤–æ–¥—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    const translations = {
      ru: {
        privet: "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ",
        yasyk: "–¢—ã –º–æ–∂–µ—à—å –≤—ã–±—Ä–∞—Ç—å —è–∑—ã–∫",
        salam: "–ó–¥—Ä–∞–≤—Å–≤—É–π –¥—Ä—É–≥!",
        my_video: "–ú–æ–µ –≤–∏–¥–µ–æ —Å YouTube:",
        expected_phrase: "–û–∂–∏–¥–∞–µ–º–∞—è —Ñ—Ä–∞–∑–∞:",
        recognized_phrase: "–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–∞—è —Ñ—Ä–∞–∑–∞:",
        result_label: "–†–µ–∑—É–ª—å—Ç–∞—Ç:",
        speak_btn: "üé§ –ì–æ–≤–æ—Ä–∏—Ç—å",
        tts_btn: "üîä –û–∑–≤—É—á–∏—Ç—å",
        refresh_btn: "–û–±–Ω–æ–≤–∏—Ç—å —Å–ª–æ–≤–∞",
        match: "‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç!",
        no_match: "‚ùå –ù–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç.",
        waiting_input: "–û–∂–∏–¥–∞–µ—Ç—Å—è –≤–≤–æ–¥...",
        listening: "–°–ª—É—à–∞—é..."
      },
      kz: {
        privet: "–°”ô–ª–µ–º",
        yasyk: "–¢—ñ–ª–¥—ñ —Ç–∞“£–¥–∞–π –∞–ª–∞—Å—ã“£",
        salam: "–°”ô–ª–µ–º –¥–æ—Å—ã–º!",
        my_video: "–ú–µ–Ω—ñ“£ YouTube-—Ç–µ–≥—ñ –±–µ–π–Ω–µ–º:",
        expected_phrase: "–ö“Ø—Ç—ñ–ª–µ—Ç—ñ–Ω —Å”©–∑ —Ç—ñ—Ä–∫–µ—Å—ñ:",
        recognized_phrase: "–¢–∞–Ω—ã–ª“ì–∞–Ω —Å”©–∑ —Ç—ñ—Ä–∫–µ—Å—ñ:",
        result_label: "–ù”ô—Ç–∏–∂–µ:",
        speak_btn: "üé§ –°”©–π–ª–µ—É",
        tts_btn: "üîä –î—ã–±—ã—Å—Ç–∞—É",
        refresh_btn: "–°”©–∑–¥–µ—Ä–¥—ñ –∂–∞“£–∞—Ä—Ç—É",
        match: "‚úÖ –°”ô–π–∫–µ—Å –∫–µ–ª–µ–¥—ñ!",
        no_match: "‚ùå –°”ô–π–∫–µ—Å –µ–º–µ—Å.",
        waiting_input: "–ï–Ω–≥—ñ–∑—É –∫“Ø—Ç—ñ–ª—É–¥–µ...",
        listening: "–¢—ã“£–¥–∞–ø —Ç“±—Ä–º—ã–Ω..."
      }
    };

    // –°–ø–∏—Å–∫–∏ —Å–ª–æ–≤ –Ω–∞ –¥–≤—É—Ö —è–∑—ã–∫–∞—Ö
    const wordLists = {
      ru: [
        "–ø—Ä–∏–≤–µ—Ç", "–¥–µ–ª–∞", "–∫–æ—Ç", "–º–∞—à–∏–Ω–∞", "–∫–æ–º–ø—å—é—Ç–µ—Ä", "—á–∞–π", "—è–±–ª–æ–∫–æ", "–¥–æ—Ä–æ–≥–∞",
        "—É—á–µ–±–∞", "—Ä–∞–±–æ—Ç–∞", "–ª—é–±–æ–≤—å", "–ª–µ—Ç–æ", "–∑–∏–º–∞", "–æ—Å–µ–Ω—å", "–≤–µ—Å–Ω–∞", "–≥–æ—Ä–æ–¥",
        "–¥—Ä—É–≥", "—Å–æ–Ω", "–º—É–∑—ã–∫–∞", "–º–æ—Ä–µ"
      ],
      kz: [
        "—Å”ô–ª–µ–º", "–∂–∞“ì–¥–∞–π", "–º—ã—Å—ã“õ", "–∫”©–ª—ñ–∫", "–∫–æ–º–ø—å—é—Ç–µ—Ä", "—à–∞–π", "–∞–ª–º–∞", "–∂–æ–ª",
        "–æ“õ—É", "–∂“±–º—ã—Å", "–º–∞—Ö–∞–±–±–∞—Ç", "–∂–∞–∑", "“õ—ã—Å", "–∫“Ø–∑", "–∫”©–∫—Ç–µ–º", "“õ–∞–ª–∞",
        "–¥–æ—Å", "“±–π“õ—ã", "–º—É–∑—ã–∫–∞", "—Ç–µ“£—ñ–∑"
      ]
    };

    let currentLang = 'ru';       // –¢–µ–∫—É—â–∏–π —è–∑—ã–∫
    let targetText = "";          // –¶–µ–ª–µ–≤–∞—è —Ñ—Ä–∞–∑–∞ (–≥–ª–æ–±–∞–ª—å–Ω–æ)
    let recognition = null;       // –û–±—ä–µ–∫—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏

    // –ü–µ—Ä–µ–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç –ø–æ data-translate
    function setLanguage(lang) {
      currentLang = lang;
      const elements = document.querySelectorAll("[data-translate]");
      elements.forEach((el) => {
        const key = el.getAttribute("data-translate");
        el.textContent = translations[lang][key] || key;
      });

      document.documentElement.lang = lang;
      generateWords();
    }

    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π —Ñ—Ä–∞–∑—ã
    function generateWords() {
      const words = wordLists[currentLang];
      const randomWords = shuffle([...words]).slice(0, 4);
      targetText = randomWords.join(" ");
      document.getElementById("target").textContent = targetText;
      document.getElementById("output").textContent = "...";
      document.getElementById("result").textContent = translations[currentLang].waiting_input;
      document.getElementById("result").style.color = "#333";
    }

    // –û–∑–≤—É—á–∏–≤–∞–Ω–∏–µ —Ñ—Ä–∞–∑—ã
    function speakText() {
      const utterance = new SpeechSynthesisUtterance(targetText);
      utterance.lang = currentLang === 'ru' ? 'ru-RU' : 'kk-KZ';
      speechSynthesis.speak(utterance);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏
    function initRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        document.getElementById('output').textContent = '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏.';
        return;
      }

      recognition = new SpeechRecognition();
      recognition.lang = currentLang === 'ru' ? 'ru-RU' : 'kk-KZ';
      recognition.interimResults = false;
      recognition.continuous = false;

      recognition.onresult = function (event) {
        const raw = event.results[0][0].transcript;
        const transcript = cleanText(raw);
        const expected = cleanText(targetText);

        document.getElementById("output").textContent = raw;

        if (transcript === expected) {
          document.getElementById("result").textContent = translations[currentLang].match;
          document.getElementById("result").style.color = "green";
        } else {
          document.getElementById("result").textContent = translations[currentLang].no_match;
          document.getElementById("result").style.color = "red";
        }
      };

      recognition.onerror = function (event) {
        document.getElementById("output").textContent = '–û—à–∏–±–∫–∞: ' + event.error;
        document.getElementById("result").textContent = '';
      };
    }

    // –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
    function cleanText(text) {
      return text
        .toLowerCase()
        .replace(/[.,!?;:()"¬´¬ª]/g, "")
        .replace(/\s+/g, " ")
        .trim();
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ì–æ–≤–æ—Ä–∏—Ç—å"
    document.getElementById('start').onclick = () => {
      if (!recognition) return;
      recognition.lang = currentLang === 'ru' ? 'ru-RU' : 'kk-KZ';
      recognition.start();
      document.getElementById("output").textContent = translations[currentLang].listening;
      document.getElementById("result").textContent = "";
    };

    function speak(text) {
      if (!('speechSynthesis' in window)) return;
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'ru-RU';
      window.speechSynthesis.speak(utterance);
    }
    function readTextOnBlockN1() {
      // –ø–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ id
      const element = document.getElementById('targetTextOnBlockN1');

      // —á–∏—Ç–∞–µ–º —Ç–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ —Ç–µ–≥–∞
      const text = element.textContent;

      speak(text);
    }
    function readTextOnBlockN2() {
      // –ø–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ id
      const element = document.getElementById('targetTextOnBlockN2');

      // —á–∏—Ç–∞–µ–º —Ç–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ —Ç–µ–≥–∞
      const text = element.textContent;

      speak(text);
    }

    function readTextOnBlockN3() {
      // –ø–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ id
      const element = document.getElementById('targetTextOnBlockN3');

      // —á–∏—Ç–∞–µ–º —Ç–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ —Ç–µ–≥–∞
      const text = element.textContent;

      speak(text);
    }

    // –ó–∞–ø—É—Å–∫
    setLanguage('ru');
    initRecognition();

     // –°–ª–æ–≤–∞ –∏ —Å–º–∞–π–ª–∏–∫–∏
    const words = ["–ö–æ—à–∫–∞", "–°–æ–±–∞–∫–∞", "–ú–∞—à–∏–Ω–∞", "–Ø–±–ª–æ–∫–æ", "–ö–Ω–∏–≥–∞", "–î–æ–º", "–°–æ–ª–Ω—Ü–µ", "–õ—É–Ω–∞"];
    const emojis = ["üê±", "üê∂", "üöó", "üçé", "üìñ", "üè†", "‚òÄÔ∏è", "üåô"];

    const cards = [];

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä –∫–∞—Ä—Ç–æ—á–µ–∫
    words.forEach((word, i) => {
      cards.push({ type: "word", value: word, pairId: i, speechValue: word });
      cards.push({ type: "emoji", value: emojis[i], pairId: i, speechValue: word }); // <-- –û–∑–≤—É—á–∏–≤–∞–µ–º —Å–ª–æ–≤–æ
    });

    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
    cards.sort(() => Math.random() - 0.5);

    const game = document.getElementById("game");
    let flippedCards = [];

    // –§—É–Ω–∫—Ü–∏—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è
    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "ru-RU";
      speechSynthesis.speak(utterance);
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
    cards.forEach(card => {
      const cardEl = document.createElement("div");
      cardEl.className = "card";

      const front = document.createElement("div");
      front.className = "card-face card-front";
      front.textContent = "?";

      const back = document.createElement("div");
      back.className = "card-face card-back";

      back.textContent = card.value;
      if (card.type === "emoji") {
        back.style.fontSize = "28px";
      }

      cardEl.appendChild(front);
      cardEl.appendChild(back);

      cardEl.dataset.pairId = card.pairId;
      cardEl.dataset.speech = card.speechValue;

      cardEl.addEventListener("click", () => {
        if (cardEl.classList.contains("flipped") || flippedCards.length === 2) return;

        cardEl.classList.add("flipped");
        speak(card.speechValue); // üëà –ß–∏—Ç–∞–µ–º –∏–º–µ–Ω–Ω–æ —Å–ª–æ–≤–æ, –¥–∞–∂–µ –¥–ª—è —Å–º–∞–π–ª–∏–∫–∞

        checkMatch(cardEl);
      });

      game.appendChild(cardEl);
    });

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
    function checkMatch(cardEl) {
      flippedCards.push(cardEl);

      if (flippedCards.length === 2) {
        const [card1, card2] = flippedCards;
        const id1 = card1.dataset.pairId;
        const id2 = card2.dataset.pairId;

        if (id1 === id2) {
          flippedCards = [];
        } else {
          setTimeout(() => {
            card1.classList.remove("flipped");
            card2.classList.remove("flipped");
            flippedCards = [];
          }, 1000);
        }
      }
    }

    const startBtn = document.getElementById('startBtn');
    const randomEmotionBtn = document.getElementById('randomEmotionBtn');
    const video = document.getElementById('video');
    const overlay = document.getElementById('overlay');
    const ctx = overlay.getContext('2d');
    const note = document.getElementById('note');
    const targetEmotionText = document.getElementById('targetEmotionText');
    const resultText = document.getElementById('resultText');
    const timerText = document.getElementById('timerText');

    // –¢–æ–ª—å–∫–æ 4 —ç–º–æ—Ü–∏–∏
    const emotionEmojis = {
      happy: 'üòä',
      angry: 'üò†',
      surprised: 'üòÆ',
      neutral: 'üòê'
    };

    const emotionNamesRu = {
      happy: '—Ä–∞–¥–æ—Å—Ç—å',
      angry: '–∑–ª–æ—Å—Ç—å',
      surprised: '—É–¥–∏–≤–ª–µ–Ω–∏–µ',
      neutral: '–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ'
    };

    const MIN_CONFIDENCE = 0.7;
    let targetEmotion = null;

    // –î–ª—è —É–¥–µ—Ä–∂–∞–Ω–∏—è —ç–º–æ—Ü–∏–∏
    let holdStartTime = null;
    let isHolding = false;
    const HOLD_TIME_MS = 2000; // 2 —Å–µ–∫—É–Ω–¥—ã

    function speak(text) {
      if (!('speechSynthesis' in window)) return;
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'ru-RU';
      window.speechSynthesis.speak(utterance);
    }

    async function start() {
      note.textContent = '–ó–∞–≥—Ä—É–∂–∞—é –º–æ–¥–µ–ª–∏...';

      const MODEL_URL = 'https://justadudewhohacks.github.io/face-api.js/models';
      await Promise.all([
        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),
        faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL)
      ]);

      note.textContent = '–ó–∞–ø—Ä–∞—à–∏–≤–∞—é –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ...';

      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
        video.srcObject = stream;
      } catch (e) {
        note.textContent = '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ: ' + e.message;
        return;
      }

      note.textContent = '–ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞. –ù–∞–∂–º–∏ –Ω–∞ –∫—Ä–∞—Å–Ω—É—é –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É –∏ –ø–æ–ª—É—á–∏—Ç—å —ç–º–æ—Ü–∏—é';
      speak('–ö–∞–º–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞. –ù–∞–∂–º–∏ –Ω–∞ –∫—Ä–∞—Å–Ω—É—é –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É –∏ –ø–æ–ª—É—á–∏—Ç—å —ç–º–æ—Ü–∏—é');
      randomEmotionBtn.disabled = false;

      video.addEventListener('play', () => {
        const detect = async () => {
          const detections = await faceapi
            .detectAllFaces(video, new faceapi.TinyFaceDetectorOptions())
            .withFaceExpressions();

          ctx.clearRect(0, 0, overlay.width, overlay.height);

          if (detections.length === 0) {
            note.textContent = '–õ–∏—Ü–æ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ üòê';
            timerText.textContent = '';
            resultText.textContent = '';
            holdStartTime = null;
            isHolding = false;
            requestAnimationFrame(detect);
            return;
          }

          detections.forEach(det => {
            const { expressions, detection } = det;
            const { x, y, width, height } = detection.box;

            const sorted = Object.entries(expressions)
              .filter(([emotion]) => emotion in emotionEmojis)
              .sort((a, b) => b[1] - a[1]);

            const [topEmotion, confidence] = sorted[0];

            const emoji = confidence > MIN_CONFIDENCE
              ? emotionEmojis[topEmotion]
              : 'ü§î';

            ctx.strokeStyle = 'lime';
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, width, height);

            ctx.font = '40px Arial';
            ctx.fillStyle = 'yellow';
            ctx.fillText(emoji, x + width / 2 - 15, y - 10);

            note.textContent = '–ü–æ–∫–∞–∑—ã–≤–∞—é —ç–º–æ—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏';

            if (targetEmotion && confidence > MIN_CONFIDENCE) {
              if (topEmotion === targetEmotion) {
                if (!isHolding) {
                  holdStartTime = performance.now();
                  isHolding = true;
                  resultText.textContent = `–î–µ—Ä–∂–∏ —ç–º–æ—Ü–∏—é ${emotionEmojis[targetEmotion]}...`;
                  timerText.textContent = `0.0 —Å–µ–∫`;
                  resultText.style.color = 'black';
                } else {
                  const heldMs = performance.now() - holdStartTime;
                  timerText.textContent = `${(heldMs / 1000).toFixed(1)} —Å–µ–∫`;

                  if (heldMs >= HOLD_TIME_MS) {
                    resultText.textContent = `–û—Ç–ª–∏—á–Ω–æ! –¢—ã –ø–æ–∫–∞–∑–∞–ª —ç–º–æ—Ü–∏—é ${emotionEmojis[targetEmotion]}!`;
                    resultText.style.color = 'green';
                    timerText.textContent = '';
                    speak(`–û—Ç–ª–∏—á–Ω–æ! –¢—ã –ø–æ–∫–∞–∑–∞–ª —ç–º–æ—Ü–∏—é ${emotionNamesRu[targetEmotion]}! –¢–µ–ø–µ—Ä—å –Ω–∞–∂–º–∏ –Ω–∞ –∫—Ä–∞—Å–Ω—É—é –∫–Ω–æ–ø–∫—É —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É!`);
                    targetEmotion = null;
                    holdStartTime = null;
                    isHolding = false;
                    targetEmotionText.textContent = '–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —ç–º–æ—Ü–∏—é';
                  }
                }
              } else {
                holdStartTime = null;
                if (isHolding) {
                  resultText.textContent = `–≠–º–æ—Ü–∏—è –∏–∑–º–µ–Ω–∏–ª–∞—Å—å, –¥–µ—Ä–∂–∏ ${emotionEmojis[targetEmotion]}!`;
                  resultText.style.color = 'orange';
                }
                isHolding = false;
                timerText.textContent = '';
              }
            } else {
              holdStartTime = null;
              isHolding = false;
              timerText.textContent = '';
              if (targetEmotion) {
                resultText.textContent = `–ü–æ–∫–∞–∂–∏ —ç–º–æ—Ü–∏—é: ${emotionEmojis[targetEmotion]}`;
                resultText.style.color = 'black';
              } else {
                resultText.textContent = '';
              }
            }
          });

          requestAnimationFrame(detect);
        };
        detect();
      });
    }

    function pickRandomEmotion() {
      const emotions = Object.keys(emotionEmojis);
      const randomIndex = Math.floor(Math.random() * emotions.length);
      targetEmotion = emotions[randomIndex];

      targetEmotionText.textContent = `–ü–æ–∫–∞–∂–∏ —ç–º–æ—Ü–∏—é: ${targetEmotion} ${emotionEmojis[targetEmotion]}`;
      resultText.textContent = `–î–µ—Ä–∂–∏ —ç–º–æ—Ü–∏—é ${emotionEmojis[targetEmotion]}...`;
      resultText.style.color = 'black';
      timerText.textContent = `0.0 —Å–µ–∫`;
      holdStartTime = null;
      isHolding = false;

      speak(`–ü–æ–∫–∞–∂–∏ —ç–º–æ—Ü–∏—é ${emotionNamesRu[targetEmotion]}`);
    }

    startBtn.addEventListener('click', start);
    randomEmotionBtn.addEventListener('click', pickRandomEmotion);
  </script>
</body>
</div>

</html>



